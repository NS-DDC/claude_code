<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">
    <!-- ✅ FIX: tools namespace를 <manifest> 루트로 이동 (빌드 에러 해소) -->

    <!-- ──────────────────────────────────────
         기본 미디어 읽기 권한
    ────────────────────────────────────────── -->
    <!-- Android 9 이하 -->
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"
        android:maxSdkVersion="32" />

    <!-- Android 13+ (API 33) - 미디어 타입별 세분화 -->
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    <uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
    <uses-permission android:name="android.permission.READ_MEDIA_AUDIO" />

    <!-- ✅ FIX: Android 14 (API 34) 부분 사진 접근 권한 추가 -->
    <uses-permission android:name="android.permission.READ_MEDIA_VISUAL_USER_SELECTED" />

    <!-- ──────────────────────────────────────
         심층 스캔: MANAGE_EXTERNAL_STORAGE
         Google Play 정책: 파일 복구 앱에만 허용
         스토어 제출 시 Declaration Form 작성 필수
    ────────────────────────────────────────── -->
    <uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE"
        tools:ignore="ScopedStorage" />

    <!-- 복구 파일 저장 (Android 9 이하) -->
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"
        android:maxSdkVersion="28" />

    <!-- 네트워크 (결제 SDK 필요) -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

    <!-- Google Play Billing -->
    <uses-permission android:name="com.android.vending.BILLING" />

    <application
        android:allowBackup="false"
        android:icon="@mipmap/ic_launcher"
        android:label="파일 복구 마스터"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.FileRecovery"
        android:requestLegacyExternalStorage="true">
        <!-- ✅ FIX: android:name=".FileRecoveryApp" 제거 (Application 클래스 미존재 시 크래시) -->
        <!-- 필요 시 Application 클래스를 별도 생성 후 추가 -->

        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:windowSoftInputMode="adjustResize"
            android:enableOnBackInvokedCallback="true">
            <!-- ✅ FIX: Android 14+ 예측 뒤로가기 제스처 지원 추가 -->
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

    </application>
</manifest>
